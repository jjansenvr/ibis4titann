<module>
	<adapter name="TestGet">
		<receiver name="GetDocument"
			className="nl.nn.adapterframework.receivers.GenericReceiver">
			<listener name="GetDocument"
				className="nl.nn.adapterframework.receivers.JavaListener"/>
		</receiver>
		
		<pipeline firstPipe="Call Archive">
			<exits>
				<exit path="READY" state="success"/>
			</exits>

			
<!-- 			<pipe name="Call InfoImage Find" 
				active="${Cmis}" 
				className="nl.nn.adapterframework.pipes.GenericMessageSendingPipe">
				<sender className="nl.nn.adapterframework.extensions.cmis.CmisSender" 
					url="${InfoImage.url}"
					repository="${InfoImage.repository}" 
					action="find" 
					bindingType="webservices" 
					keepSession="${cmis.keepsession.getbyid}">
					<param name="authAlias" value="${AuthAliasGet4}"/>
					<param name="userName" value="cmisgetstr01" />
				</sender>
				<forward name="success" path="Check Response for multiple results"/>
				<forward name="timeout" path="throwException"/>
				<forward name="illegalResult" path="throwException"/>
			</pipe>
			<pipe name="Check Response for multiple results" 
				className="nl.nn.adapterframework.pipes.XmlSwitch" 
				serviceSelectionStylesheetFilename="BS_GetDocumentAndAttributes_4/xsl/CheckResult.xsl">
				<forward name="multiple results" path="Transform functional Error Response"/>
				<forward name="zero results" path="Transform functional Error Response"/>
				<forward name="success" path="Put ID in Pipeline"/>
			</pipe>
			
			<pipe name="Transform functional Error Response" 
				className="nl.nn.adapterframework.pipes.XsltPipe" 
				styleSheetName="BS_GetDocumentAndAttributes_4/xsl/TransformErrorResponse.xsl" 
				xslt2="true" 
				skipEmptyTags="true">
				<forward name="success" path="READY"/>
			</pipe>
			
			<pipe name="Put ID in Pipeline" 
				className="nl.nn.adapterframework.pipes.XsltPipe" 
				xpathExpression="/cmis/rowset/row/property[@name='cmis:objectId']" 
				xslt2="true">
				<forward name="success" path="Call InfoImage"/>
			</pipe>
			Get By ID
			<pipe name="Prepare request getbyID" 
				className="nl.nn.adapterframework.pipes.XsltPipe" 
				xpathExpression="GetDocumentAndAttributes_Request/ID" 
				xslt2="true">
				<forward name="success" path="Call InfoImage"/>
			</pipe>
			start stub 
			<pipe name="Call InfoImage"
				active="${Stub}"
				className="nl.nn.adapterframework.pipes.EchoPipe">
				<forward name="success" path="READY"/>
			</pipe>
			end stub  -->
			<pipe name="Call Archive" 
				className="nl.nn.adapterframework.pipes.GenericMessageSendingPipe"
				storeResultInSessionKey="CMIS Output">
				<sender className="nl.nn.adapterframework.extensions.cmis.CmisSender"
					url="${cmis.url}"
					repository="${cmis.repository}" 
					action="get"
					bindingType="browser"
					getProperties="true" 
					fileContentSessionKey="ref_filecontent" 
					keepSession="${cmis.keepsession}"
					userName="jeroen"
					password="Welkom01">
					
				</sender>
				<forward name="success" path="READY"/>
				<forward name="timeout" path="READY"/>
				<forward name="illegalResult" path="READY"/>
			</pipe>
			
		</pipeline>
	</adapter>	
</module>